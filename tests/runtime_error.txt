INFO: Logger initialized. Console logging is ENABLED.

======================================================================
                         AVAILABLE TESTS
======================================================================
  [1] TestCANLogPlayback.test_can_log_playback
  [2] TestCANService.test_can_service_integration
  [3] TestDataCorruption.test_race_condition_with_lock
  [4] TestDataCorruption.test_race_condition_without_lock
  [5] TestDualPipelineSimulation.test_low_frequency_signals_are_processed
  [6] TestLiveDataPipeline.test_data_integrity_in_live_pipeline
  [7] TestLiveDataPipeline.test_imu_stuck_flag_ignores_grade
  [8] TestLiveDataPipeline.test_numpy_float64_corruption_fix
  [9] TestLiveDataPipeline.test_startup_race_condition_fix
  [10] TestMainAppLogic.test_dual_pipeline_from_log_file

  [all] Run all tests
======================================================================

Enter test number(s) to run (e.g., '1,3,5'), or 'all': [+] Initializing CAN Service...
 -> Ensuring CAN interface is up...
Error: Failed to bring up CAN interface 'can0'.
 -> STDERR: Cannot find device "can0"
 -> Please check your CAN hardware and drivers.
 -> Loading DBC and signal list...
 -> Connecting to CAN hardware...
 -> Connection successful on 'socketcan' channel can0.
 -> Starting 3 decoding processes...
[+] CAN Service running.

[+] Shutting down CAN Service...

--- CANReader Diagnostics ---
Total messages received by CANReader: 1918
Total messages dropped due to full queue: 0
-----------------------------

[+] CAN Service stopped.
.
--- Subprocess Output ---
[Test Runner] Starting CAN service integration test in isolated process...
[+] Initializing CAN Service...
 -> Ensuring CAN interface is up...
Error: Failed to bring up CAN interface 'can0'.
 -> STDERR: Cannot find device "can0"
 -> Please check your CAN hardware and drivers.
 -> Loading DBC and signal list...
DEBUG: Loading and parsing signal list...
DEBUG: --- CAN ID to Queue Mapping (INTEGER KEYS) ---
 -> ID: 147849472 (0x8d00100) mapped to 'high' queue.
--------------------------------------------------
 -> Connecting to CAN hardware...
 -> Connection successful on 'socketcan' channel can0.
DEBUG [CANReader]: Match found! ID: 147849472 (0x8d00100) -> Queue: 'high'
 -> Starting 3 decoding processes...
[+] CAN Service running.
DEBUG [CANReader]: Match found! ID: 147849472 (0x8d00100) -> Queue: 'high'

[+] Shutting down CAN Service...
[+] CAN Service stopped.
[Test Runner] Final interpolated value: 4.0
[Test Runner] Assertions passed.
[Test Runner] Success: Test completed without errors.

--- Subprocess Stderr ---
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/src/can_service/can_handler.py", line 25, in run
    msg = self.bus.recv(timeout=0.001)
  File "/usr/lib/python3.13/unittest/mock.py", line 1169, in __call__
    return self._mock_call(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/unittest/mock.py", line 1173, in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/unittest/mock.py", line 1230, in _execute_mock_call
    result = next(effect)
StopIteration

-------------------------

.
--- Subprocess Output for with_lock ---

--- Running test_race_condition_with_lock ---
[Writer 1] Starting. Use lock: True
[Writer 0] Starting. Use lock: True
[Writer 3] Starting. Use lock: True
[Writer 2] Starting. Use lock: True
[Reader] Starting.
[Writer 2] Finished.
[Writer 1] Finished.
[Writer 3] Finished.
[Writer 0] Finished.
[Reader] Finished. Saw IDs: [0, 1, 2, 3]
Writer IDs seen (with lock): [0, 1, 2, 3]
Success: All writer IDs were observed, lock is effective.

-------------------------------------------

.
--- Subprocess Output for without_lock ---

--- Running test_race_condition_without_lock ---
[Writer 2] Starting. Use lock: False
[Writer 3] Starting. Use lock: False
[Writer 1] Starting. Use lock: False
[Writer 0] Starting. Use lock: False
[Reader] Starting.
[Writer 1] Finished.
[Writer 3] Finished.
[Writer 2] Finished.
[Writer 0] Finished.
[Reader] Finished. Saw IDs: [0, 1, 2, 3]
Writer IDs seen (no lock): [0, 1, 2, 3]
Warning: Race condition was not detected in this run. This is acceptable.
The test demonstrates that data loss is possible, but not guaranteed on every run.

-------------------------------------------

.
--- Subprocess Output ---

--- Processed Signals ---
- ETS_VCU_Gear_Engaged_St_enum: Found 82 values.
- ETS_VCU_imuProc_xaccel: Found 82 values.
- ETS_VCU_imuProc_yaccel: Found 82 values.
- ETS_VCU_imuProc_zaccel: Found 82 values.
- ETS_VCU_EstimatedGrade_Est_Deg: Found 82 values.
- ETS_VCU_imuProc_imuStuck_B: Found 82 values.
- ETS_VCU_imuProc_rollCF: Found 82 values.
- ETS_VCU_imuProc_pitchCF: Found 82 values.
- ETS_VCU_imuProc_rollRate: Found 82 values.
- ETS_VCU_imuProc_pitchRate: Found 82 values.
- ETS_VCU_imuProc_yawRate: Found 82 values.
- ETS_MOT_ShaftTorque_Est_Nm: Found 81 values.
- ETS_VCU_BrakePressStatus_St_enum: Found 8 values.
- ETS_VCU_VehSpeed_Act_kmph: Found 8 values.
- ETS_VCU_AccelPedal_Act_perc: Found 8 values.
Success: Low frequency signal was processed correctly.

-------------------------

.
--- Subprocess Output for data_integrity ---

--- Subprocess Stderr for data_integrity ---
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.

-------------------------------------------

.
--- Subprocess Output for imu_stuck ---

--- Subprocess Stderr for imu_stuck ---
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.

-------------------------------------------

.
--- Subprocess Output for numpy_corruption ---

--- Subprocess Stderr for numpy_corruption ---
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.

-------------------------------------------

.
--- Subprocess Output for startup_race ---

--- Subprocess Stderr for startup_race ---
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.
INFO: Logger initialized. Console logging is ENABLED.

-------------------------------------------

.F
======================================================================
FAIL: test_dual_pipeline_from_log_file (test_main_app_logic.TestMainAppLogic.test_dual_pipeline_from_log_file)
Tests the main application's dual-pipeline logic in an isolated process.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/tests/test_cases/test_main_app_logic.py", line 67, in test_dual_pipeline_from_log_file
    result = subprocess.run(
        [sys.executable, runner_script_path],
    ...<3 lines>...
        timeout=30
    )
  File "/usr/lib/python3.13/subprocess.py", line 577, in run
    raise CalledProcessError(retcode, process.args,
                             output=stdout, stderr=stderr)
subprocess.CalledProcessError: Command '['/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/.venv/bin/python3', '/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/tests/test_cases/../lib/main_app_logic_test_runner.py']' returned non-zero exit status 1.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/tests/test_cases/test_main_app_logic.py", line 82, in test_dual_pipeline_from_log_file
    self.fail(
    ~~~~~~~~~^
        f"The isolated test process failed with exit code {e.returncode}.\n"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        f"--- STDOUT ---\n{e.stdout}\n"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        f"--- STDERR ---\n{e.stderr}"
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
AssertionError: The isolated test process failed with exit code 1.
--- STDOUT ---
DEBUG: Loading and parsing signal list...
DEBUG: --- CAN ID to Queue Mapping (INTEGER KEYS) ---
 -> ID: 154 (0x9a) mapped to 'high' queue.
 -> ID: 155 (0x9b) mapped to 'high' queue.
 -> ID: 160 (0xa0) mapped to 'high' queue.
 -> ID: 161 (0xa1) mapped to 'high' queue.
 -> ID: 162 (0xa2) mapped to 'high' queue.
 -> ID: 173 (0xad) mapped to 'high' queue.
 -> ID: 782 (0x30e) mapped to 'low' queue.
 -> ID: 783 (0x30f) mapped to 'low' queue.
 -> ID: 784 (0x310) mapped to 'low' queue.
--------------------------------------------------

--- Test Results ---
Signals logged: set()

--- STDERR ---
Failure: An exception occurred: A known high-frequency signal (MOT_ShaftTorque_Est_Nm) was not logged.
Traceback (most recent call last):
  File "/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/tests/test_cases/../lib/main_app_logic_test_runner.py", line 116, in <module>
    main()
    ~~~~^^
  File "/home/sachin/sachin_wrk/CANenbl_unifiedRadarTrcker/tests/test_cases/../lib/main_app_logic_test_runner.py", line 109, in main
    assert 'MOT_ShaftTorque_Est_Nm' in logged_signals_set, "A known high-frequency signal (MOT_ShaftTorque_Est_Nm) was not logged."
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: A known high-frequency signal (MOT_ShaftTorque_Est_Nm) was not logged.


----------------------------------------------------------------------
Ran 10 tests in 65.890s

FAILED (failures=1)


======================================================================
                         TEST SUITE SUMMARY
======================================================================

Total tests run: 10
Passed: 0
Failed: 1
Errors: 0
Skipped: 0

--- FAILED ---
  [-] TestMainAppLogic.test_dual_pipeline_from_log_file

======================================================================
